unit DWorkPermits;

interface

uses
  System.SysUtils, System.Classes, DBase, DMain, Data.DB, Data.Win.ADODB,
  Forms, Common, FBaseDev1;

type
  TDMWorkPermits = class(TDMBase)
    qryWork_Permit: TADOQuery;
    qryContractors: TADOQuery;
    qryContractorsid: TIntegerField;
    qryContractorsName: TWideStringField;
    qryContractorsCompany: TWideStringField;
    qryContractorsVAT: TWideStringField;
    qryContractorsInsUsr: TIntegerField;
    qryContractorsInsDT: TDateTimeField;
    qryContractorsNotes: TWideStringField;
    dtsContractors: TDataSource;
    qryDepartments: TADOQuery;
    dtsDepartments: TDataSource;
    qryDepartmentsid: TIntegerField;
    qryDepartmentsName: TWideStringField;
    dtsWork_Permit: TDataSource;
    qryWork_PermitLContractor: TStringField;
    qryWork_PermitLDepartment: TStringField;
    qryWork_PermitId: TIntegerField;
    qryWork_PermitDepartment_Id: TIntegerField;
    qryWork_PermitContractor_Id: TIntegerField;
    qryWork_PermitNumber_of_Workers: TIntegerField;
    qryWork_PermitΜονάδα_Εργασίας: TWideStringField;
    qryWork_PermitΕξοπλισμος: TWideStringField;
    qryWork_PermitStart_Time: TDateTimeField;
    qryWork_PermitEnd_Time: TDateTimeField;
    qryWork_PermitΠΕΡΙΓΡΑΦΗ_ΕΡΓΑΣΙΑΣ: TWideStringField;
    qryWork_PermitΙΚΡΙΩΜΑ: TBooleanField;
    qryWork_PermitΕΚΣΚΑΦΗ: TBooleanField;
    qryWork_PermitΓΕΡΑΝΟΣ: TBooleanField;
    qryWork_PermitΕΙΣΟΔΟΣ_ΣΕ_ΚΛΕΙΣΤΟ_ΧΩΡΟ: TBooleanField;
    qryWork_PermitΘΕΡΜΗ_ΕΡΓΑΣΙΑ: TBooleanField;
    qryWork_PermitΡΑΔΙΟΓΡΑΦΙΕΣ: TBooleanField;
    qryWork_PermitΚΟΙΝΗ_ΕΡΓΑΣΙΑ: TBooleanField;
    qryWork_PermitΑπαιτείται_έλεγχος_αερίων: TBooleanField;
    qryWork_PermitΕύφλεκετα: TBooleanField;
    qryWork_PermitΗ2S: TBooleanField;
    qryWork_PermitCO: TBooleanField;
    qryWork_PermitO2: TBooleanField;
    qryWork_PermitΧΕΙΡΙΣΤΗΣ_ΕΛΕΓΧΟ: TWideStringField;
    qryWork_PermitΚΩΔΙΚΟΣ_ΟΡΓΑΝΟΥ: TWideStringField;
    qryWork_PermitΑποσυμπίεση_εξοπλισμού: TBooleanField;
    qryWork_PermitΥγρά_εγλωβισμένα_βάνες: TBooleanField;
    qryWork_PermitΚαθαρίστηκε_εξοπλισμός: TBooleanField;
    qryWork_PermitΣυμπληρωματικός_φωτισμός: TBooleanField;
    qryWork_PermitOχήματα_φλογοπαγίδες: TBooleanField;
    qryWork_PermitΠροειδοποιητικά_σήματα: TBooleanField;
    qryWork_PermitΕκκένωση_εξοπλισμού: TBooleanField;
    qryWork_PermitΑπομόνωση_εξοπλισμού: TBooleanField;
    qryWork_PermitΚαθαρισμός_ατμός: TBooleanField;
    qryWork_PermitΚαθαρισμός_άζωτο: TBooleanField;
    qryWork_PermitΚαθαρισμός_νερό: TBooleanField;
    qryWork_PermitΚάλυψη_υπονόμων: TBooleanField;
    qryWork_PermitΣυμπληρωματικά_μέτρα: TWideStringField;
    qryWork_PermitΠαρίσταση_χειριστής: TWideStringField;
    qryWork_PermitΙικρίωμα_πιστοποιημένο: TBooleanField;
    qryWork_PermitΓνωμάτευση_ΑΕΕ: TBooleanField;
    qryWork_PermitΑΑ_βεβαίωσης_ικριώματος: TWideStringField;
    qryWork_PermitΈλαβα_γνώση_ΑΕΕ: TWideStringField;
    qryWork_PermitΥπόγειοι_αγωγοί: TBooleanField;
    qryWork_PermitΥπόγεια_καλώδια: TBooleanField;
    qryWork_PermitΕκσκαφη_με_μηχανικα_μεσα: TBooleanField;
    qryWork_PermitΑναγνώριση_του_χώρου_εκσκαφής: TBooleanField;
    qryWork_PermitΣυμπληρωματικά_μέτρα_εκσκαφή: TWideStringField;
    qryWork_PermitΣυμπληρώθηκε_το_έντυπο_ελέγχου: TBooleanField;
    qryWork_PermitΑρ_εντύπου_κλειστου_χώρου: TWideStringField;
    qryWork_PermitΈγινε_μέτρηση_έλεγχος_αερίων: TBooleanField;
    qryWork_PermitΈλαβα_γνώση_και_συμφωνώ_ο_αιτήσας_την_ΑΕΕ: TWideStringField;
    qryWork_PermitΗλεκτρολογική_απομόνωση: TBooleanField;
    qryWork_PermitΣυνεχής_παρουσία_ηλεκτρολόγου: TBooleanField;
    qryWork_PermitΚαλώδια_μονωμένα: TBooleanField;
    qryWork_PermitΦωτιστικά_σώματα: TBooleanField;
    qryWork_PermitΠινακίδα_ηλεκτρικής_απομόνωσης: TBooleanField;
    qryWork_PermitΑρ_πινακιδίων_απομόνωσης: TIntegerField;
    qryWork_PermitΗλεκτρολόγος: TWideStringField;
    qryWork_PermitΈντυπο_θερμές_εργασίες: TBooleanField;
    qryWork_PermitΑρ_εντύπου_θερμές_εργασίες: TWideStringField;
    qryWork_PermitΈντυπο_ραδιογραφίες: TBooleanField;
    qryWork_PermitΑρ_εντύπου_ραδιογραφίες: TWideStringField;
    qryWork_PermitΚράνος_κεφαλής: TBooleanField;
    qryWork_PermitΓάντια_εργασίας: TBooleanField;
    qryWork_PermitΗλεκτρολογικά_γάντια: TBooleanField;
    qryWork_PermitΟματουάλια: TBooleanField;
    qryWork_PermitΠροσωπίδα: TBooleanField;
    qryWork_PermitΕλαστικά_υποδήματα: TBooleanField;
    qryWork_PermitΩτοασπίδες: TBooleanField;
    qryWork_PermitΦόρμα_εργασίας: TBooleanField;
    qryWork_PermitΖώνη_ανάρτησης_σε_ύψος: TBooleanField;
    qryWork_PermitΑναπνευστική_συσκευή: TBooleanField;
    qryWork_PermitΑποφεύγετε_επαφή_με_το_δέρμα: TBooleanField;
    qryWork_PermitΣυμπληρωματικά_μέτρα_Ατομικής_Προστασίας: TWideStringField;
    qryWork_PermitΠυροσβεστήρες: TIntegerField;
    qryWork_PermitΜάνικες: TIntegerField;
    qryWork_PermitΑλλα_μέσα_πυρόσβεσης: TWideStringField;
    qryWork_PermitΕιδικά_εργαλεία: TWideStringField;
    qryWork_PermitΕργοδηγος_τμήματος: TWideStringField;
    qryWork_PermitΠροβλεπόμενα_ΜΑΠ: TBooleanField;
    qryWork_PermitΠροβλεπόμενα_μέτρα_ασφαλείας: TBooleanField;
    qryWork_PermitΤΑ_εγκατάστασης: TBooleanField;
    qryWork_PermitΗ_ΕΡΓΑΣΙΑ_ΔΙΕΚΟΠΗ_ΑΠΟ_ΤΟΝ: TWideStringField;
    qryWork_PermitΗ_ΕΡΓΑΣΙΑ_ΔΙΕΚΟΠΗ_ΩΡΑ: TWideStringField;
    qryWork_PermitΛΟΓΟΣ_ΑΝΑΚΛΗΣΗΣ: TWideStringField;
    qryWork_PermitInsUsr: TIntegerField;
    qryWork_PermitInsDT: TDateTimeField;
    qryWork_PermitIssue_Date: TDateTimeField;
    qryForemen: TADOQuery;
    IntegerField1: TIntegerField;
    WideStringField1: TWideStringField;
    dtsForemen: TDataSource;
    qryWork_PermitΕύφλεκετα_Value: TFloatField;
    qryWork_PermitΗ2S_Value: TFloatField;
    qryWork_PermitCO_Value: TFloatField;
    qryWork_PermitO2_Value: TFloatField;
    qryWork_PermitΈντυπο_γερανου: TBooleanField;
    qryWork_PermitΑρ_εντύπου_γερανου: TWideStringField;
    qryWork_PermitForeman_Id: TIntegerField;
    qryWork_PermitFullFilled: TBooleanField;
    qryWork_PermitFullFilledDT: TDateTimeField;
    qryWork_PermitFullFilledUsr: TIntegerField;
    qryWork_PermitFullFilledCancel: TBooleanField;
    qryWork_PermitΕγκρίση_ΤΑ_Υπερ: TBooleanField;
    qryWork_PermitΟ_αιτων_την_αδεια_εκτελεσης_εργασιας: TWideStringField;
    qryWork_PermitΟ_Τεχνικος_Ασφαλειας_της_εγκαταστασης: TWideStringField;
    qryWork_PermitΑπαιτείται_συνεχής_έλεγχος_αερίων: TBooleanField;
    qryWork_PermitΕργοδηγος_εργολάβου: TWideStringField;
    qryWork_PermitΑυτόνομη_αναπνευστική_συσκευή: TBooleanField;
    qryWork_PermitAirpack: TBooleanField;
    qryWork_PermitΔιαφυγής_10_λεπτών: TBooleanField;
    qryWork_PermitΠροσωπικά_ολοκλήρου_Προσώπου_με_φίλτρο: TBooleanField;
    qryWork_PermitΜάσκα_Σκόνης: TBooleanField;
    qryWork_PermitΠαρατηρήσεις: TWideStringField;
    qryWork_Permitγ1_Περιέχοντα_τώρα: TBooleanField;
    qryWork_Permitγ1_Περιέχοντα_πρίν: TBooleanField;
    qryWork_Permitγ1_Εύφλεκτο: TBooleanField;
    qryWork_Permitγ1_Εκρηκτικό: TBooleanField;
    qryWork_Permitγ1_Διαβρωτικό: TBooleanField;
    qryWork_Permitγ1_Τοξικό: TBooleanField;
    qryWork_Permitγ1_Καυστικό: TBooleanField;
    qryWork_Permitγ1_Ερεθιστικό: TBooleanField;
    qryWork_Permitγ1_Εξοπλισμός_υπό_ηλεκτρική_τάση: TBooleanField;
    qryWork_Permitγ1_Ενεργός_τώρα: TBooleanField;
    qryWork_Permitγ1_Ενεργός_πρίν: TBooleanField;
    qryWork_Permitγ2_Πτώση_από_ύψος: TBooleanField;
    qryWork_Permitγ2_Υψηλή_πίεση: TBooleanField;
    qryWork_Permitγ2_Ηλεκτρικοί_Κίνδυνοι: TBooleanField;
    qryWork_Permitγ2_Είσοδος_σε_κλειστό_Χώρο: TBooleanField;
    qryWork_Permitγ2_Υψηλή_Θερμοκρασία: TBooleanField;
    qryWork_Permitγ2_Ραδιογραφία: TBooleanField;
    qryWork_Permitγ2_Πιθανότητα_Διαρροής: TBooleanField;
    qryWork_Permitγ2_Χημικά: TBooleanField;
    qryWork_Permitγ2_Άλλα_: TWideStringField;
    qryWork_Permitγ3_Μονάδα_σε_λειτουργεία: TBooleanField;
    qryWork_Permitγ3_Υπόγειες_ηλεκτρικές_γραμμές_υπό_τάση: TBooleanField;
    qryWork_Permitγ3_H2S_Υδρόθειο: TBooleanField;
    qryWork_Permitγ3_HC_Υδρογονάνφρακες: TBooleanField;
    qryWork_Permitγ3_Παράλληλες_Εργασίες_SIMOPS: TBooleanField;
    qryWork_Permitγ3_Εύφλεκτο: TBooleanField;
    qryWork_Permitγ3_Περιοχή_Ταξινομημένη_κατά_ATEX: TBooleanField;
    qryWork_Permitγ3_Θόρυβος: TBooleanField;
    qryWork_Permitγ3_Άλλα_: TWideStringField;
    qryWork_Permitγ1_Περιεχόμενα_Ρευστά_της_Διεργασίας_κατά_την_Λειτουργία: TBooleanField;
    qryWork_Permitγ1_Πίεση: TFloatField;
    qryWork_Permitγ1_Θερμοκρασία: TFloatField;
    qryWork_PermitΑριθμός_Πινακιδίων: TWideStringField;
    qryWork_PermitΑριθμός_Σχεδίου: TWideStringField;
    qryDepartment_Foremen: TADOQuery;
    IntegerField2: TIntegerField;
    WideStringField2: TWideStringField;
    drsDepartment_Foremen: TDataSource;
    qryWork_PermitDepartment_Foreman_Id: TIntegerField;
    spUpdate_Work_Permit_Status: TADOStoredProc;
    qryWork_PermitFrom_Id_Copy: TIntegerField;
    qryWork_PermitVisible_Till: TDateTimeField;
    qryWork_PermitDeleted: TBooleanField;
    qryWork_PermitDelUsr: TIntegerField;
    qryWork_PermitDelDT: TDateTimeField;
    qryWork_PermitΑρ_Γνωστοποιησης: TWideStringField;
    qryWork_PermitLFrom_Id_Copy: TStringField;
    qryWork_PermitWorkStopped: TBooleanField;
    qryWork_PermitWorkStoppedUsr: TIntegerField;
    qryWork_PermitWorkStoppedDT: TDateTimeField;
    procedure DataModuleCreate(Sender: TObject);
    procedure qryWorkersVisitBeforePost(DataSet: TDataSet);
    procedure qryWorkersVisitAfterPost(DataSet: TDataSet);
    procedure dtsWorkersVisitStateChange(Sender: TObject);
    procedure GenAfterPost(DataSet: TDataSet);
    procedure GenBeforePost(DataSet: TDataSet);
    procedure qryWorkersVisitCalcFields(DataSet: TDataSet);
    procedure qryWork_PermitCalcFields(DataSet: TDataSet);
  private


    { Private declarations }
  public
    procedure CheckUpdateParam;
    { Public declarations }
  end;

implementation

{ %CLASSGROUP 'System.Classes.TPersistent' }

uses FMain;

{$R *.dfm}

procedure TDMWorkPermits.DataModuleCreate(Sender: TObject);
begin
  inherited;
  spUpdate_Work_Permit_Status.ExecProc();
  DMCreate(TForm(self),'qryWorkersVisit');
end;

procedure TDMWorkPermits.dtsWorkersVisitStateChange(Sender: TObject);
begin
  inherited;
  if self.Owner is TfrmBaseDev1 then
    if TDataSource(Sender).State in [dsInsert, dsEdit] then
      begin
        TfrmBaseDev1(self.Owner).SetState('UPD')
      end
    else
      begin
        TfrmBaseDev1(self.Owner).SetState('Browse');
      end;

end;

procedure TDMWorkPermits.qryWorkersVisitAfterPost(DataSet: TDataSet);
begin
  inherited;
  DMMain.TblChanges.UpdateBatch();
end;

procedure TDMWorkPermits.qryWorkersVisitBeforePost(DataSet: TDataSet);
begin
  inherited;
  BeforePost0(DataSet, 'WorkersVisit');
end;

procedure TDMWorkPermits.qryWorkersVisitCalcFields(DataSet: TDataSet);
begin
  inherited;
//  qryWorkersVisitPContractors_Id.AsInteger := 1;//qryWorkersVisitContractors_Id.AsInteger;
end;

procedure TDMWorkPermits.qryWork_PermitCalcFields(DataSet: TDataSet);
begin
  inherited;
  if qryWork_PermitFrom_Id_Copy.AsInteger > 0 then
     qryWork_PermitLFrom_Id_Copy.AsString := '(' + inttostr(qryWork_PermitFrom_Id_Copy.AsInteger) + ')'
  else
    qryWork_PermitLFrom_Id_Copy.AsString := '';


end;

procedure TDMWorkPermits.GenAfterPost(DataSet: TDataSet);
begin
  inherited;
//  DMMain.TblChanges.UpdateBatch();
end;


procedure TDMWorkPermits.GenBeforePost(DataSet: TDataSet);
var nStr:string;
begin

  if DataSet is TADOQuery then
  begin
    nStr:=StringReplace(DataSet.Name,'qry','',[]);
    BeforePost0(DataSet, nStr);
  end
  else
  begin
    BeforePost0(DataSet);
  end;
//  BeforePost0(DataSet, 'CarsVisitOther');
end;

procedure TDMWorkPermits.CheckUpdateParam;
var PName,PCompany,PIdentity:string;
begin
//  PName     :=frmMain.String2Pho(qryPersonsVisitName.Text);
//  PCompany  :=frmMain.String2Pho(qryPersonsVisitCompany.Text);
//  PIdentity :=frmMain.String2Pho(qryPersonsVisitIdentityNo.Text);
//  qryPersons.Insert;
//  qryPersons.Edit;
//  qryPersonsPerson.AsString       := qryPersonsVisitName.Text;
//  qryPersonsPhoPerson.AsString    := PName;
//  qryPersonsCompany.AsString      := qryPersonsVisitCompany.Text;
//  qryPersonsPhoCompany.AsString   := PCompany;
//  qryPersonsIdentityNo.AsString   := qryPersonsVisitIdentityNo.Text;
//  qryPersonsPhoIdentityNo.AsString:= PIdentity;
//  qryPersons.Post;
end;

//var PName:string;
//begin
//  inherited;
//  PName:=frmMain.String2Pho(cxdbtName.Text);
//  if DM.qryPersons.Locate('PhoName',PName,[]) then
//
//  else
//    begin
//      DM.qryPersons.Insert;
//      DM.qryPersons.Edit;
//      DM.qryPersonsPerson.AsString    := cxdbtName.Text;
//      DM.qryPersonsPhoPerson.AsString := PName;
//      DM.qryPersons.Post;
//    end;



end.
